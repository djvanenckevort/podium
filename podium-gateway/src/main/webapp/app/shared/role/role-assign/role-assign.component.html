<!--
  ~ Copyright (c) 2017. The Hyve and respective contributors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  ~
  -->

<h4><span jhiTranslate="podiumGatewayApp.role.home.title">Roles</span></h4>

<div class="container-fluid" *ngIf="organisationRoles">
    <div class="row">
        <form name="roleForm" role="form" novalidate #roleForm="ngForm">
            <jhi-alert></jhi-alert>
            <jhi-alert-error></jhi-alert-error>

            <div class="alert alert-warning">
                <span>
                    <i class="material-icons">warning</i>
                    Changes in the roles will be saved immediately.
                </span>
            </div>

            <div class="table-responsive">

                <!-- for each organisation role create a table where users with authorities are added -->
                <table class="table">
                    <thead>
                        <tr>
                            <th jhiTranslate="podiumGatewayApp.role.users">User</th>
                            <th jhiTranslate="podiumGatewayApp.role.role">Role</th>
                            <th jhiTranslate="podiumGatewayApp.role.options">Options</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let user of organisationUsers; trackBy: trackByUuid">
                            <td>
                                <input [(ngModel)]="user.searchTerm"
                                       name="userTypeahead-{{ user.uuid }}"
                                       [typeahead]="user.dataSource"
                                       (typeaheadNoResults)="changeTypeaheadNoResults($event)"
                                       (typeaheadOnSelect)="typeaheadOnSelect($event, user)"
                                       [typeaheadWaitMs]="300"
                                       typeaheadOptionsLimit="7"
                                       typeaheadOptionField="fullName"
                                       placeholder="Search for a user by fullname"
                                       autocomplete="off"
                                       class="form-control">

                                <div *ngIf="typeaheadNoResults === true">
                                    <i class="material-icons">clear</i> No Results Found
                                </div>
                            </td>
                            <td>
                                <!-- Authority select -->
                                <select class="form-control" id="field_authority_user" name="authority-{{ user.uuid }}" [(ngModel)]="user.authority" [disabled]="">
                                    <option [ngValue]="undefined" disabled selected>Please select a role</option>
                                    <option [ngValue]="authorityOption.token === user.authority ? user.authority : authorityOption.token" *ngFor="let authorityOption of authorityOptions; trackBy: trackAuthorityByToken">{{authorityOption.name}}</option>
                                </select>
                            </td>
                            <td class="role-actions">
                                <span class="role-option default" tooltip="Update user role" *ngIf="user.uuid && user.isSaved">
                                    <i class="material-icons">update</i>
                                </span>
                                <span class="role-option success" tooltip="Add user role" *ngIf="user.uuid && user.authority && !user.isSaved" (click)="save(user)">
                                    <i class="material-icons">add</i>
                                </span>
                                <span class="role-option warn" tooltip="Remove user role" *ngIf="user.uuid">
                                    <i class="material-icons">clear</i>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>

