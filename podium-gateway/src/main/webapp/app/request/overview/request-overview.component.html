<!--
  ~ Copyright (c) 2017. The Hyve and respective contributors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  ~
  -->

<!-- Request status sidebar -->
<div id="wrapper" [ngClass]="{'toggled': toggledSidebar}">
    <div id="sidebar-wrapper">
        <pdm-request-status-sidebar
            [userGroupAuthority]="userGroupAuthority"
            [pageParams]="getPageParams.bind(this)"
        ></pdm-request-status-sidebar>
    </div>
    <div id="page-content-wrapper">

        <div class="sidebar-toggle-btn"
             tooltip="Toggle sidebar"
             placement="right"
             (click)="toggleSidebar()">
            <span class="material-icons">keyboard_arrow_right</span>
        </div>

        <h2>
            <span jhiTranslate="{{pageHeader}}">My requests</span>
        </h2>

        <jhi-alert></jhi-alert>

        <br/>
        <div class="table-responsive" *ngIf="availableRequests">
            <table class="table table-striped">
                <thead>
                    <tr  jhiSort [(predicate)]="predicate" [(ascending)]="reverse" [callback]="transitionRequests.bind(this)">
                        <th jhiSortBy="id">
                            <span>Request id</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th jhiSortBy="requestDetail.title">
                            <span>Title</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th jhiSortBy="status">
                            <span>Status</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th><span>Request type</span></th>
                        <th><span>Organisations</span></th>
                        <th jhiSortBy="requestDetail.requester.firstName" *ngIf="!isResearcherRoute()">
                            <span>Requester</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th jhiSortBy="requestDetail.principalInvestigator.name" *ngIf="!isResearcherRoute()">
                            <span>Principal investigator</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th jhiSortBy="createdDate">
                            <span>Date created</span>
                            <span class="fa fa-sort"></span>
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let request of availableRequests; trackBy: trackId">
                        <td>
                            {{request.id}}
                        </td>
                        <td>
                            {{request.requestDetail.title || '-'}}
                        </td>
                        <td>
                            {{request.status}} {{ request.status == 'Review' ? '(' + request.requestReview.status + ')' : '' }}
                        </td>
                        <td>
                            <ul>
                                <li *ngFor="let requestTypes of request.requestDetail.requestType">{{requestTypes}}</li>
                            </ul>
                        </td>
                        <td>
                            <ul>
                                <li *ngFor="let organisation of request.organisations">{{organisation.name}}</li>
                            </ul>
                        </td>
                        <td *ngIf="!isResearcherRoute()">
                            {{ request.requester.firstName }} {{ request.requester.lastName }}
                        </td>
                        <td *ngIf="!isResearcherRoute()">
                            {{request.requestDetail.principalInvestigator.name || '-'}}
                        </td>
                        <td>
                            {{request.createdDate | date:'shortDate' }}
                        </td>
                        <td class="text-xs-right">
                            <div class="btn-group flex-btn-group-container" *ngIf="request.status === 'Draft'">
                                <button type="button" class="btn btn-primary btn-sm"  (click)="editRequest(request)">
                                    <i class="material-icons">edit</i>
                                    <span class="hidden-md-down" jhiTranslate="request.action.edit">Edit</span>
                                </button>
                                <button type="submit" class="btn btn-danger btn-sm" (click)="deleteDraft(request)">
                                    <i class="material-icons">remove_circle_outline</i>
                                    <span class="hidden-md-down" jhiTranslate="request.action.delete">Remove</span>
                                </button>
                            </div>
                            <button type="button"
                                    class="btn btn-primary btn-sm" (click)="navigateToRequestDetail(request)"
                                    *ngIf="request.status !== 'Draft'">
                                <i class="material-icons md-18">assignment_ind</i>
                                <span class="hidden-md-down" jhiTranslate="request.action.details">Details</span>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="availableRequests.length == 0">
                        <td colspan="10" class="no-results">
                            <div class="alert alert-info">
                                No requests found
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="text-xs-center" *ngIf="availableRequests && availableRequests.length">
                <jhi-item-count [page]="page" [total]="queryCount" [itemsPerPage]="itemsPerPage"></jhi-item-count>
                <ngb-pagination [collectionSize]="totalItems" [(page)]="page" (pageChange)="loadPage(page, loadRequests.bind(this))"></ngb-pagination>
            </div>
        </div>
    </div>
</div>
