<!--
  ~ Copyright (c) 2017. The Hyve and respective contributors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  ~
  -->

<h2><span jhiTranslate="{{pageHeader}}">My requests</span>

    <div class="btn-group flex-btn-group-container" *ngIf="isResearcherRoute()">
        <button class="btn btn-warning float-xs-right create-organisation active" (click)="loadMyReviewRequests()">
            <i class="material-icons">assignment_ind</i>
            <span class="hidden-sm-down">
                Submitted
            </span>
        </button>
        <button class="btn btn-info float-xs-right create-organisation active" (click)="loadMyDeliveryRequests()">
            <i class="material-icons">local_shipping</i>
            <span class="hidden-sm-down">
                Delivery
            </span>
        </button>
        <button class="btn btn-primary float-xs-right create-organisation active" (click)="loadMyApprovedRequests()">
            <i class="material-icons">thumb_up</i>
            <span class="hidden-sm-down">
                Approved
            </span>
        </button>
        <button class="btn btn-success float-xs-right create-organisation" (click)="loadDrafts()">
            <i class="material-icons">drafts</i>
            <span class="hidden-sm-down">
                Drafts
            </span>
        </button>
        <button class="btn btn-primary float-xs-right create-organisation" (click)="createNewRequest()">
            <i class="material-icons">add_circle_outline</i>
            <span class="hidden-sm-down">
            Create new request
            </span>
        </button>
    </div>
    <div class="btn-group flex-btn-group-container" *ngIf="isCoordinatorRoute()">
        <button class="btn btn-warning float-xs-right create-organisation active"
                (click)="loadCoordinatorReviewRequests()">
            <i class="material-icons">assignment_ind</i>
            <span class="hidden-sm-down">
                Submitted
            </span>
        </button>
        <button class="btn btn-info float-xs-right create-organisation active"
                (click)="loadCoordinatorApprovedRequests()">
            <i class="material-icons">thumb_up</i>
            <span class="hidden-sm-down">
                Approved
            </span>
        </button>
        <button class="btn btn-primary float-xs-right create-organisation active"
                (click)="loadCoordinatorDeliveryRequests()">
            <i class="material-icons">local_shipping</i>
            <span class="hidden-sm-down">
                Delivery
            </span>
        </button>
    </div>
</h2>

<jhi-alert></jhi-alert>
<br/>
<div class="table-responsive" *ngIf="availableRequests">
    <table class="table table-striped">
        <thead>
        <tr jhiSort [(predicate)]="predicate" [(ascending)]="reverse"
            [callback]="transitionRequests.bind(this)">
            <th jhiSortBy="requestDetail.requester.firstName">
                <span class="material-icons  md-18">link</span>
            </th>
            <th jhiSortBy="id">
                <span>Request id</span>
                <span class="fa fa-sort"></span>
            </th>
            <th jhiSortBy="requestDetail.title">
                <span>Title</span>
                <span class="fa fa-sort"></span>
            </th>
            <th jhiSortBy="status" *ngIf="isActiveStatus(statusSidebarOptions.All)">
                <span>Status</span>
                <span class="fa fa-sort"></span>
            </th>
            <th><span>Request type</span></th>
            <th><span>Organisation(s)</span></th>
            <th jhiSortBy="requestDetail.requester.firstName" *ngIf="!isResearcherRoute()">
                <span>Requester</span>
                <span class="fa fa-sort"></span>
            </th>
            <th jhiSortBy="requestDetail.principalInvestigator.name" *ngIf="!isResearcherRoute()">
                <span>Principal investigator</span>
                <span class="fa fa-sort"></span>
            </th>
            <th jhiSortBy="createdDate">
                <span>Date created</span>
                <span class="fa fa-sort"></span>
            </th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let request of availableRequests; trackBy: trackId">
            <td>
                    <span class="material-icons md-18"
                          *ngIf="getIconForLinkedRequest(request.requestDetail.combinedRequest)">link</span>
            </td>
            <td class="test-id">
                {{request.id}}
            </td>
            <td class="test-title">
                {{request.requestDetail.title || '-'}}
            </td>
            <td *ngIf="isActiveStatus(statusSidebarOptions.All)">
                {{request.status}}
                {{ request.status == 'Review' ? '(' + request.requestReview.status + ')' : '' }}
            </td>
            <td>
                <ul class="overview-list-cell test-requestTypes">
                    <li *ngFor="let requestType of request.requestDetail.requestType">
                            <span class="material-icons md-18">
                                {{ getIconForRequestType(requestType)}}
                            </span>
                        <span test-requestType-text>{{requestType}}</span>
                    </li>
                </ul>
            </td>
            <td>
                <ul class="overview-list-cell test-organisations"
                    [ngClass]="{'draft-request': request.status == 'Draft'}">
                    <li *ngFor="let organisation of request.organisations">{{organisation.name}}</li>
                </ul>
            </td>
            <td class="test-requesterName" *ngIf="!isResearcherRoute()">
                {{ request.requester.firstName }} {{ request.requester.lastName }}
            </td>
            <td class="test-piName" *ngIf="!isResearcherRoute()">
                {{request.requestDetail.principalInvestigator.name || '-'}}
            </td>
            <td>
                {{request.createdDate | date:'shortDate' }}
            </td>
            <td class="text-xs-right">
                <div class="btn-group flex-btn-group-container" *ngIf="request.status === 'Draft'">
                    <button type="button" class="btn btn-primary btn-sm" (click)="editRequest(request)">
                        <i class="material-icons">edit</i>
                        <span class="hidden-md-down" jhiTranslate="request.action.edit">Edit</span>
                    </button>
                    <button type="submit" class="btn btn-danger btn-sm" (click)="deleteDraft(request)">
                        <i class="material-icons">remove_circle_outline</i>
                        <span class="hidden-md-down" jhiTranslate="request.action.delete">Remove</span>
                    </button>
                </div>
                <button type="button"
                        class="btn btn-primary btn-sm" (click)="navigateToRequestDetail(request)"
                        *ngIf="request.status !== 'Draft'">
                    <i class="material-icons md-18">assignment_ind</i>
                    <span class="hidden-md-down" jhiTranslate="request.action.details">Details</span>
                </button>
            </td>
        </tr>
        <tr *ngIf="availableRequests.length == 0">
            <td colspan="10" class="no-results">
                <div class="alert alert-info">
                    No requests found
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="text-xs-center" *ngIf="availableRequests && availableRequests.length">
        <jhi-item-count [page]="page" [total]="queryCount" [itemsPerPage]="itemsPerPage"></jhi-item-count>
        <ngb-pagination
            [collectionSize]="totalItems"
            [(page)]="page"
            (pageChange)="loadPage(page, transitionRequests.bind(this))">
        </ngb-pagination>
    </div>
</div>
