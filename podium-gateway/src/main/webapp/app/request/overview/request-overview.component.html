<!--
  ~ Copyright (c) 2017. The Hyve and respective contributors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  ~
  -->

<h2><span>My Requests</span>
    <div class="btn-group flex-btn-group-container">
        <button class="btn btn-warning float-xs-right create-organisation active" (click)="loadSubmittedRequests()" >
            <i class="material-icons">assignment_ind</i>
            <span class="hidden-sm-down">
            My requests
            </span>
        </button>
        <button class="btn btn-success float-xs-right create-organisation" (click)="loadDrafts()">
            <i class="material-icons">drafts</i>
            <span class="hidden-sm-down">
                Show Drafts
            </span>
        </button>
        <button class="btn btn-primary float-xs-right create-organisation" (click)="createNewRequest()">
            <span class="material-icons">add_circle_outline</span>
            <span class="hidden-sm-down">
            Create new request
            </span>
        </button>
    </div>
</h2>

<jhi-alert></jhi-alert>

<br/>
<div class="table-responsive" *ngIf="availableRequests">
    <table class="table table-striped">
        <thead>
        <tr>
            <th><span>Request Id</span></th>
            <th><span>Title</span></th>
            <th><span>Status</span></th>
            <th><span>Request Type</span></th>
            <th><span>Organisations</span></th>
            <th><span>Created Date</span></th>
            <th><span>Last Modified</span></th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let request of availableRequests; trackBy: trackId">
            <td>
                {{request.id}}
            </td>
            <td>
                {{request.requestDetail.title || '-'}}
            </td>
            <td>
                {{request.status}}
            </td>
            <td>
                <ul>
                    <li *ngFor="let requestTypes of request.requestDetail.requestType">{{requestTypes}}</li>
                </ul>
            </td>
            <td>
                <ul>
                    <li *ngFor="let organisation of request.organisations">{{organisation.uuid}}</li>
                </ul>
            </td>
            <td>
                {{request.createdDate | date:'medium' }}
            </td>
            <td>
                {{request.lastModifiedDate | date:'medium' }}
            </td>
            <td class="text-xs-right">
                <div class="btn-group flex-btn-group-container" *ngIf="request.status === 'Draft'">
                    <button type="button" class="btn btn-primary btn-sm"  (click)="editRequest(request)">
                        <span class="material-icons">edit</span>
                        <span class="hidden-md-down" jhiTranslate="request.action.edit">Edit</span>
                    </button>
                    <button type="submit" class="btn btn-danger btn-sm" (click)="deleteDraft(request)">
                        <span class="material-icons">remove_circle_outline</span>
                        <span class="hidden-md-down" jhiTranslate="request.action.delete">Remove</span>
                    </button>
                </div>
                <button type="button"
                        class="btn btn-primary btn-sm" (click)="navigateToRequestDetail(request)"
                        *ngIf="request.status !== 'Draft'">
                    <span class="material-icons md-18">assignment_ind</span>
                    <span class="hidden-md-down" jhiTranslate="request.action.details">Details</span>
                </button>
            </td>
        </tr>
        <tr *ngIf="availableRequests.length == 0">
            <td colspan="7" class="no-results">
                <div class="alert alert-info">
                    No requests found
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="text-xs-center" *ngIf="availableRequests && availableRequests.length">
        <jhi-item-count [page]="page" [total]="queryCount" [itemsPerPage]="itemsPerPage"></jhi-item-count>
        <ngb-pagination [collectionSize]="totalItems" [(page)]="page" (pageChange)="loadPage(page)"></ngb-pagination>
    </div>
</div>
